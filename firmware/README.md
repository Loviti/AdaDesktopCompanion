# Ada Particles — ESP32 Belly Display Firmware

Renders images as living particle clouds on a 466x466 AMOLED display.
Images are generated by Ada's server (SD-Turbo diffusion) and sent over WebSocket as base64-encoded RGB pixels. The particles float, swirl, pulse, and drift based on Ada's emotional state.

## Hardware

- **Board:** Waveshare ESP32-S3-Touch-AMOLED-1.75
- **Display:** 466x466 AMOLED with CO5300 driver (QSPI)
- **SoC:** ESP32-S3 with 8MB PSRAM

## Arduino IDE Setup

### Board Settings
- **Board:** ESP32S3 Dev Module
- **PSRAM:** OPI PSRAM
- **Flash Size:** 16MB
- **Partition Scheme:** Huge APP (3MB No OTA/1MB SPIFFS)
- **USB CDC On Boot:** Enabled

### Required Libraries

Install via **Tools** → **Manage Libraries** in Arduino IDE:

- **Arduino_GFX_Library** by moononournation
- **ArduinoWebsockets** by gilmaimon  
- **ArduinoJson** by bblanchon

#### ESP32_IO_Expander (Optional but Recommended)

The `ESP32_IO_Expander` library is used for power management on the Waveshare board. It's **optional** - the code will compile without it, but power management features will be disabled.

**To install manually:**
1. Download from: https://github.com/esp-arduino-libs/ESP32_IO_Expander
2. Extract to your Arduino libraries folder:
   - **Mac**: `~/Documents/Arduino/libraries/ESP32_IO_Expander/`
   - **Windows**: `Documents\Arduino\libraries\ESP32_IO_Expander\`
   - **Linux**: `~/Arduino/libraries/ESP32_IO_Expander/`
3. Restart Arduino IDE
4. In `ada_particles.ino`, uncomment the line: `#define USE_IO_EXPANDER`

**Note:** If you get a compilation error about missing `ESP32_IO_Expander.h`, the code is configured to compile without it. The display should still work, but you may need to enable power manually on the board.

## Configuration

Edit `config.h`:
```cpp
#define WIFI_SSID "YOUR_WIFI_SSID"
#define WIFI_PASSWORD "YOUR_WIFI_PASSWORD"
#define SERVER_HOST "10.10.10.100"  // Ada server IP
```

## Protocol

The server sends JSON messages over WebSocket:

### `particles` — New image + config
```json
{
  "type": "particles",
  "image": "<base64 RGB pixels>",
  "width": 128,
  "height": 128,
  "config": { ... }
}
```

### `mood` — Config-only update (no new image)
```json
{
  "type": "mood",
  "config": {
    "particle_count": 800,
    "particle_size": 3.0,
    "particle_speed": 1.0,
    "dispersion": 30.0,
    "animation": "float",
    ...
  }
}
```

### `clear` — Fade out all particles
```json
{"type": "clear"}
```

## Animation Types

- **float** — gentle random drift around home position (LISTENING)
- **drift** — very slow lazy movement (IDLE)
- **swirl_inward** — particles orbit toward center (THINKING)
- **pulse_outward** — particles push outward in waves (TALKING)

## Files

- `ada_particles.ino` — Main sketch (WiFi, WebSocket, render loop)
- `config.h` — Pin definitions, network config, physics defaults
- `particle_system.h` — Particle physics engine and renderer
- `base64_decode.h` — Base64 decoder for image data
